<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Create Post</title>
</head>
<body>
<form id="post-form">
    <label for="user-id">User ID:</label>
    <input type="text" id="user-id" name="userId" required><br>
    <label for="post-title">Post Title:</label>
    <input type="text" id="post-title" name="postTitle" required><br>
    <label for="post-content">Post Content:</label>
    <textarea id="post-content" name="postContent" required></textarea><br>
    <label for="post-image">Post Image:</label>
    <input type="file" id="post-image" name="postImage" required><br>
    <button type="submit">Create Post</button>
</form>

<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-storage.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDekDvFeWi_YXHxu9yTxVItlpNXWpb3JzQ",
        authDomain: "frogify-18287.firebaseapp.com",
        projectId: "frogify-18287",
        storageBucket: "frogify-18287.appspot.com",
        messagingSenderId: "835340601197",
        appId: "1:835340601197:web:c09b74f2d3721178823c64",
        measurementId: "G-WH77ZLHS6H"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);

    const form = document.querySelector('#post-form');
    form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const userId = document.querySelector('#user-id').value;
        const postTitle = document.querySelector('#post-title').value;
        const postContent = document.querySelector('#post-content').value;
        const postImage = document.querySelector('#post-image').files[0];

        // Upload the image to Firebase Storage
        const storageRef = firebase.storage().ref();
        const imageRef = storageRef.child(postImage.name);
        const snapshot = await imageRef.put(postImage);
        const imageUrl = await snapshot.ref.getDownloadURL();

        const data = {
            userId,
            postTitle,
            postContent,
            postImageUrl: imageUrl,
        };

        const response = await fetch('http://localhost:4499/post/createpost', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data),
        });

        const jsonResponse = await response.json();
        console.log(jsonResponse);
    });
</script>
</body>
</html>
